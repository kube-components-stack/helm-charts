# https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#projects
---
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: {{ include "kube-components-stack.fullname" . }}
  annotations:
    helm.sh/hook-weight: "-1"
spec:
  clusterResourceWhitelist:
  - group: admissionregistration.k8s.io
    kind: MutatingWebhookConfiguration
  - group: admissionregistration.k8s.io
    kind: ValidatingWebhookConfiguration
  - group: apiextensions.k8s.io
    kind: CustomResourceDefinition
  - group: apiregistration.k8s.io
    kind: APIService
  - group: ""
    kind: Namespace
  - group: policy
    kind: PodSecurityPolicy
  - group: rbac.authorization.k8s.io
    kind: ClusterRole
  - group: rbac.authorization.k8s.io
    kind: ClusterRoleBinding
  - group: networking.k8s.io
    kind: IngressClass
{{- if .Values.apps.certificates.enabled }}
  - group: cert-manager.io
    kind: ClusterIssuer
{{- end }}
  destinations:
  - namespace: {{ .Release.Namespace }}
    server: https://kubernetes.default.svc
{{- range $k, $v := .Values.apps }}
  {{- if $v.enabled }}
  - namespace: {{ $v.namespace }}
    server: https://kubernetes.default.svc
  {{- end }}
{{- end }}
  sourceRepos:
  - https://kube-components-stack.github.io/helm-charts
{{- if .Values.apps.certificates.enabled }}
  - https://charts.jetstack.io
{{- end }}
{{- if .Values.apps.ingress.enabled }}
  - https://kubernetes.github.io/ingress-nginx
{{- end }}
{{- if .Values.apps.loadBalancing.enabled }}
  - https://metallb.github.io/metallb
{{- end }}
{{- if .Values.apps.logging.enabled }}
  - https://grafana.github.io/helm-charts
  - https://helm.vector.dev
{{- end }}
{{- if .Values.apps.metrics.enabled }}
  - https://kubernetes-sigs.github.io/metrics-server
{{- end }}
{{- if .Values.apps.monitoring.enabled }}
  - https://github.com/prometheus-community/helm-charts.git
  - https://kube-components-stack.github.io/helm-charts
{{- end }}
{{- if .Values.apps.mutating.enabled }}
  - https://github.com/MalibuKoKo/kubemod-helm.git
  - https://kube-components-stack.github.io/helm-charts
{{- end }}
{{- if .Values.apps.notifications.enabled }}
  - https://argoproj.github.io/argo-helm
{{- end }}
{{- if .Values.apps.objectStorage.enabled }}
  - https://charts.min.io
{{- end }}
